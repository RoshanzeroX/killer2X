// ==UserScript==
// @name          VARS - Video Auto-Resume System
// @namespace     http://tampermonkey.net/
// @version       1.5
// @description   Automatically clicks the "Click to Identify" and "Confirm" buttons, and resumes videos.
// @match         https://lmsrv.siammakro.co.th/
// @grant         none
// ==/UserScript==

(function () {
    'use strict';

    let enabled = true;

    // สร้างปุ่ม Toggle สำหรับเปิด/ปิดสคริปต์
    const toggleBtn = document.createElement('button');
    toggleBtn.innerText = '🎬 AutoResume: ON';
    Object.assign(toggleBtn.style, {
        position: 'fixed',
        bottom: '10px',
        right: '10px',
        zIndex: 9999,
        padding: '8px 12px',
        background: '#222',
        color: '#fff',
        border: 'none',
        borderRadius: '5px',
        cursor: 'pointer',
        fontSize: '14px'
    });

    document.addEventListener('DOMContentLoaded', () => {
        document.body.appendChild(toggleBtn);
        console.log('VARS script is running and button has been added.');
    });
    
    // ตั้งค่าการคลิกปุ่ม Toggle
    toggleBtn.onclick = () => {
        enabled = !enabled;
        toggleBtn.innerText = `🎬 AutoResume: ${enabled ? 'ON' : 'OFF'}`;
    };

    // ฟังก์ชันหลักสำหรับคลิกปุ่มอัตโนมัติ
    const autoClickButtons = () => {
        if (!enabled) return;

        // ขั้นตอนที่ 1: หาและคลิกปุ่ม "Click to Identify"
        const identifyButton = Array.from(document.querySelectorAll('button, div, a'))
            .find(el => el.textContent.trim().toLowerCase().includes('click to identify'));

        if (identifyButton && identifyButton.offsetParent !== null) {
            console.log('✅ Found and clicking "Click to Identify"...');
            identifyButton.click();

            // รอสักครู่ก่อนคลิกปุ่ม "Confirm"
            setTimeout(() => {
                // ขั้นตอนที่ 2: หาและคลิกปุ่ม "Confirm"
                const confirmButton = Array.from(document.querySelectorAll('button, div, a'))
                    .find(el => el.textContent.trim().startsWith('Confirm'));

                if (confirmButton && confirmButton.offsetParent !== null) {
                    console.log('✅ Found and clicking the Confirm button...');
                    confirmButton.click();
                }
            }, 500);
        }
    };

    setInterval(autoClickButtons, 1000);

    // ฟังก์ชันสำหรับเล่นวิดีโอที่หยุดไว้โดยอัตโนมัติ
    const handledVideos = new WeakSet();
    setInterval(() => {
        if (!enabled) return;
        const videos = document.querySelectorAll('video');
        videos.forEach(video => {
            if (handledVideos.has(video)) return;
            handledVideos.add(video);

            setInterval(() => {
                if (!enabled) return;
                if (video.paused && video.readyState >= 2) {
                    video.play().catch(e => console.warn('Play error:', e));
                }
            }, 1000);
        });
    }, 1000);
})();
        
