// ==UserScript==
// @name          VARS - Video Auto-Resume System
// @namespace     http://tampermonkey.net/
// @version       1.5
// @description   Automatically clicks the "Click to Identify" and "Confirm" buttons, and resumes videos.
// @match         https://lmsrv.siammakro.co.th/
// @grant         none
// ==/UserScript==

(function () {
    'use strict';

    let enabled = true;

    // à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸¸à¹ˆà¸¡ Toggle à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸›à¸´à¸”/à¸›à¸´à¸”à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œ
    const toggleBtn = document.createElement('button');
    toggleBtn.innerText = 'ðŸŽ¬ AutoResume: ON';
    Object.assign(toggleBtn.style, {
        position: 'fixed',
        bottom: '10px',
        right: '10px',
        zIndex: 9999,
        padding: '8px 12px',
        background: '#222',
        color: '#fff',
        border: 'none',
        borderRadius: '5px',
        cursor: 'pointer',
        fontSize: '14px'
    });

    document.addEventListener('DOMContentLoaded', () => {
        document.body.appendChild(toggleBtn);
        console.log('VARS script is running and button has been added.');
    });
    
    // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸à¸²à¸£à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡ Toggle
    toggleBtn.onclick = () => {
        enabled = !enabled;
        toggleBtn.innerText = `ðŸŽ¬ AutoResume: ${enabled ? 'ON' : 'OFF'}`;
    };

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸«à¸¥à¸±à¸à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
    const autoClickButtons = () => {
        if (!enabled) return;

        // à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 1: à¸«à¸²à¹à¸¥à¸°à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡ "Click to Identify"
        const identifyButton = Array.from(document.querySelectorAll('button, div, a'))
            .find(el => el.textContent.trim().toLowerCase().includes('click to identify'));

        if (identifyButton && identifyButton.offsetParent !== null) {
            console.log('âœ… Found and clicking "Click to Identify"...');
            identifyButton.click();

            // à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆà¸à¹ˆà¸­à¸™à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡ "Confirm"
            setTimeout(() => {
                // à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 2: à¸«à¸²à¹à¸¥à¸°à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡ "Confirm"
                const confirmButton = Array.from(document.querySelectorAll('button, div, a'))
                    .find(el => el.textContent.trim().startsWith('Confirm'));

                if (confirmButton && confirmButton.offsetParent !== null) {
                    console.log('âœ… Found and clicking the Confirm button...');
                    confirmButton.click();
                }
            }, 500);
        }
    };

    setInterval(autoClickButtons, 1000);

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸¥à¹ˆà¸™à¸§à¸´à¸”à¸µà¹‚à¸­à¸—à¸µà¹ˆà¸«à¸¢à¸¸à¸”à¹„à¸§à¹‰à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
    const handledVideos = new WeakSet();
    setInterval(() => {
        if (!enabled) return;
        const videos = document.querySelectorAll('video');
        videos.forEach(video => {
            if (handledVideos.has(video)) return;
            handledVideos.add(video);

            setInterval(() => {
                if (!enabled) return;
                if (video.paused && video.readyState >= 2) {
                    video.play().catch(e => console.warn('Play error:', e));
                }
            }, 1000);
        });
    }, 1000);
})();
        
